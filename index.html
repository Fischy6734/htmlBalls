<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online HTML Editor</title>
    <link rel="icon" type="image/x-icon" href="icon/icon.png">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark {
            background-color: #2c2c2c;
            color: #f4f4f4;
        }
        header, nav, section {
            margin-bottom: 20px;
        }
        textarea, input[type="file"] {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 15px;
            margin-right: 10px;
            cursor: pointer;
        }
        .project-list {
            list-style: none;
            padding: 0;
        }
        .project-list li {
            margin: 5px 0;
        }
        .dark-mode-btn {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<header>
    <h1>Online HTML Editor</h1>
    <button class="dark-mode-btn" id="darkModeBtn">Toggle Dark Mode</button>
</header>

<nav>
    <h2>Your Projects</h2>
    <ul class="project-list" id="projectList"></ul>
    <button id="newProjectBtn">New Project</button>
</nav>

<section>
    <h2>HTML</h2>
    <textarea id="htmlInput" placeholder="Write your HTML code here..."></textarea>
</section>

<section>
    <h2>CSS</h2>
    <input type="text" id="cssFileName" placeholder="CSS File Name (without extension)">
    <textarea id="cssInput" placeholder="Write your CSS code here..."></textarea>
    <h3>Add Custom Font (OTF)</h3>
    <input type="file" id="fontInput" accept=".otf">
    <button id="addFontBtn">Add Font</button>
</section>

<section>
    <h2>JavaScript</h2>
    <input type="text" id="jsFileName" placeholder="JavaScript File Name (without extension)">
    <textarea id="jsInput" placeholder="Write your JavaScript code here..."></textarea>
</section>

<button id="downloadBtn">Download Files</button>
<button id="addMoreBtn">Add More HTML/CSS</button>

<section>
    <h2>Output</h2>
    <iframe id="outputFrame" style="width: 100%; height: 300px; border: 1px solid #ccc;"></iframe>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
    const darkModeBtn = document.getElementById('darkModeBtn');
    const body = document.body;

    // Toggle dark mode
    darkModeBtn.addEventListener('click', () => {
        body.classList.toggle('dark');
    });

    // Project management
    const projectList = document.getElementById('projectList');
    const projects = JSON.parse(localStorage.getItem('projects')) || [];

    function renderProjects() {
        projectList.innerHTML = '';
        projects.forEach((project, index) => {
            const li = document.createElement('li');
            li.textContent = project.name;
            li.addEventListener('click', () => loadProject(index));
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteProject(index);
            });
            li.appendChild(deleteBtn);
            projectList.appendChild(li);
        });
    }

    function loadProject(index) {
        const project = projects[index];
        document.getElementById('htmlInput').value = project.html;
        document.getElementById('cssInput').value = project.css;
        document.getElementById('jsInput').value = project.js;
        document.getElementById('cssFileName').value = project.cssFileName;
        document.getElementById('jsFileName').value = project.jsFileName;
        updateOutput();
    }

    function deleteProject(index) {
        projects.splice(index, 1);
        localStorage.setItem('projects', JSON.stringify(projects));
        renderProjects();
    }

    document.getElementById('newProjectBtn').addEventListener('click', () => {
        const name = prompt('Project Name:');
        if (name) {
            projects.push({ name, html: '', css: '', js: '', cssFileName: '', jsFileName: '' });
            localStorage.setItem('projects', JSON.stringify(projects));
            renderProjects();
        }
    });

    // Add custom font
    document.getElementById('addFontBtn').addEventListener('click', () => {
        const fontInput = document.getElementById('fontInput');
        if (fontInput.files.length > 0) {
            const confirmAdd = confirm('Are you sure you want to add this font?');
            if (confirmAdd) {
                const file = fontInput.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    const fontFace = `@font-face { font-family: '${file.name}'; src: url('${event.target.result}'); }`;
                    const style = document.createElement('style');
                    style.innerHTML = fontFace;
                    document.head.appendChild(style);
                    alert('Font added successfully!');
                };
                reader.readAsDataURL(file);
            }
        } else {
            alert('Please select a font file.');
        }
    });

    // Save progress to local storage
    function saveProgress() {
        const project = {
            html: document.getElementById('htmlInput').value,
            css: document.getElementById('cssInput').value,
            js: document.getElementById('jsInput').value,
            cssFileName: document.getElementById('cssFileName').value || 'style',
            jsFileName: document.getElementById('jsFileName').value || 'script'
        };
        const currentProjectIndex = projects.findIndex(p => p.html === project.html && p.css === project.css && p.js === project.js);
        if (currentProjectIndex !== -1) {
            projects[currentProjectIndex] = project;
        }
        localStorage.setItem('projects', JSON.stringify(projects));
    }

    // Load progress from local storage
    function loadProgress() {
        renderProjects();
        const lastProject = projects[projects.length - 1];
        if (lastProject) {
            loadProject(projects.length - 1);
        }
    }

    // Update output frame
    function updateOutput() {
        const html = document.getElementById('htmlInput').value;
        const css = `<style>${document.getElementById('cssInput').value}</style>`;
        const js = document.getElementById('jsInput').value;
        const outputFrame = document.getElementById('outputFrame').contentWindow.document;
        outputFrame.open();
        outputFrame.write(html + css + `<script>${js}<\/script>`);
        outputFrame.close();
    }

    // Download files
    document.getElementById('downloadBtn').addEventListener('click', () => {
        saveProgress();
        const htmlContent = document.getElementById('htmlInput').value;
        const cssContent = document.getElementById('cssInput').value;
        const jsContent = document.getElementById('jsInput').value;
        const cssFileName = document.getElementById('cssFileName').value || 'style';
        const jsFileName = document.getElementById('jsFileName').value || 'script';
        
        const zip = new JSZip();
        zip.file('index.html', htmlContent + '\n<!-- Made with HTML Balls -->');
        if (cssContent) zip.file(`${cssFileName}.css`, cssContent);
        if (jsContent) zip.file(`${jsFileName}.js`, jsContent);
        
        zip.generateAsync({ type: "blob" }).then(function(content) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = 'project.zip';
            a.click();
        });
    });

    // Event listeners for input changes
    document.querySelectorAll('textarea').forEach(textarea => {
        textarea.addEventListener('input', updateOutput);
    });

    // Load progress on page load
    window.onload = loadProgress;
    window.onbeforeunload = saveProgress;
</script>

</body>
</html>
